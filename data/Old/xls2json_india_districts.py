#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Convert the WashWatch spreadsheet into our JSON format

Usage:
    xls2json.py [--verbose] <xlsPercentFile> <xlsAbsoluteFile>
    xls2json.py (-h | --help)

Options:
    -h --help       Show this screen
    -v --verbose    Output verbose javascript
"""

# script to read in Excel spreadsheet and spit out the json format we
# need

from __future__ import unicode_literals

import json
import sys

from docopt import docopt
import xlrd

# The below maps the state / district names to codes that match what's in the map file

NAME_CODE = {

	"Andamans":"IN.AN.AN",
	"Nicobars":"IN.AN.NI",
	"Adilabad":"IN.AN.AD",
	"Anantapur":"IN.AN.AN",
	"Chittoor":"IN.AN.CH",
	"East Godavari":"IN.AN.EA",
	"Guntur":"IN.AN.GU",
	"Hyderabad":"IN.AN.HY",
	"Karimnagar":"IN.AN.KA",
	"Khammam":"IN.AN.KH",
	"Krishna":"IN.AN.KR",
	"Kurnool":"IN.AN.KU",
	"Mahbubnagar":"IN.AN.MA",
	"Medak":"IN.AN.ME",
	"Nalgonda":"IN.AN.NA",
	"Nizamabad":"IN.AN.NI",
	"Prakasam":"IN.AN.PR",
	"Rangareddy":"IN.AN.RA",
	"Sri Potti Sriramulu Nellore (Nellore)":"IN.AN.SR",
	"Srikakulam":"IN.AN.SR",
	"Visakhapatnam":"IN.AN.VI",
	"Vizianagaram":"IN.AN.VI",
	"Warangal":"IN.AN.WA",
	"West Godavari":"IN.AN.WE",
	"Y.S.R. (Cuddapah)":"IN.AN.Y.",
	"Changlang":"IN.AR.CH",
	"East Kameng":"IN.AR.EA",
	"East Siang":"IN.AR.EA",
	"Lohit":"IN.AR.LO",
	"Lower Subansiri":"IN.AR.LO",
	"Papum Pare":"IN.AR.PA",
	"Tawang":"IN.AR.TA",
	"Tirap":"IN.AR.TI",
	"Upper Siang":"IN.AR.UP",
	"Upper Subansiri":"IN.AR.UP",
	"West Kameng":"IN.AR.WE",
	"West Siang":"IN.AR.WE",
	"Barpeta":"IN.AS.BA",
	"Bongaigaon":"IN.AS.BO",
	"Cachar":"IN.AS.CA",
	"Darrang":"IN.AS.DA",
	"Dhemaji":"IN.AS.DH",
	"Dhubri":"IN.AS.DH",
	"Dibrugarh":"IN.AS.DI",
	"Goalpara":"IN.AS.GO",
	"Golaghat":"IN.AS.GO",
	"Hailakandi":"IN.AS.HA",
	"Jorhat":"IN.AS.JO",
	"Kamrup":"IN.AS.KA",
	"Karbi Anglong":"IN.AS.KA",
	"Karimganj":"IN.AS.KA",
	"Kokrajhar":"IN.AS.KO",
	"Lakhimpur":"IN.AS.LA",
	"Morigaon":"IN.AS.MO",
	"Nagaon":"IN.AS.NA",
	"Nalbari":"IN.AS.NA",
	"Dima Hasao (North Cachar Hills)":"IN.AS.DI",
	"Sivasagar":"IN.AS.SI",
	"Sonitpur":"IN.AS.SO",
	"Tinsukia":"IN.AS.TI",
	"Araria":"IN.BI.AR",
	"Aurangabad":"IN.BI.AU",
	"Banka":"IN.BI.BA",
	"Begusarai":"IN.BI.BE",
	"Kaimur (Bhabua)":"IN.BI.KA",
	"Bhagalpur":"IN.BI.BH",
	"Bhojpur":"IN.BI.BH",
	"Buxar":"IN.BI.BU",
	"Darbhanga":"IN.BI.DA",
	"Gaya":"IN.BI.GA",
	"Gopalganj":"IN.BI.GO",
	"Jamui":"IN.BI.JA",
	"Jehanabad":"IN.BI.JE",
	"Katihar":"IN.BI.KA",
	"Khagaria":"IN.BI.KH",
	"Kishanganj":"IN.BI.KI",
	"Lakhisarai":"IN.BI.LA",
	"Madhepura":"IN.BI.MA",
	"Madhubani":"IN.BI.MA",
	"Munger":"IN.BI.MU",
	"Muzaffarpur":"IN.BI.MU",
	"Nalanda":"IN.BI.NA",
	"Nawada":"IN.BI.NA",
	"Pashchim Champaran":"IN.BI.PA",
	"Patna":"IN.BI.PA",
	"Purba Champaran":"IN.BI.PU",
	"Purnia":"IN.BI.PU",
	"Rohtas":"IN.BI.RO",
	"Saharsa":"IN.BI.SA",
	"Samastipur":"IN.BI.SA",
	"Saran":"IN.BI.SA",
	"Sheikhpura":"IN.BI.SH",
	"Sheohar":"IN.BI.SH",
	"Sitamarhi":"IN.BI.SI",
	"Siwan":"IN.BI.SI",
	"Supaul":"IN.BI.SU",
	"Vaishali":"IN.BI.VA",
	"Chandigarh":"IN.CH.CH",
	"Bastar":"IN.CH.BA",
	"Bilaspur":"IN.CH.BI",
	"Dantewada":"IN.CH.DA",
	"Dhamtari":"IN.CH.DH",
	"Durg":"IN.CH.DU",
	"JanjgirChampa":"IN.CH.JA",
	"Jashpur":"IN.CH.JA",
	"Uttar Bastar Kanker (Kanker)":"IN.CH.UT",
	"Kabirdham":"IN.CH.KA",
	"Korba":"IN.CH.KO",
	"Koriya":"IN.CH.KO",
	"Mahasamund":"IN.CH.MA",
	"Raigarh":"IN.CH.RA",
	"Raipur":"IN.CH.RA",
	"Rajnandgaon":"IN.CH.RA",
	"Surguja":"IN.CH.SU",
	"Dadra & Nagar Haveli":"IN.DA.DA",
	"Daman":"IN.DA.DA",
	"Diu":"IN.DA.DI",
	"Delhi":"IN.DE.DE",
	"North Goa":"IN.GO.NO",
	"South Goa":"IN.GO.SO",
	"Ahmadabad":"IN.GU.AH",
	"Amreli":"IN.GU.AM",
	"Anand":"IN.GU.AN",
	"Banas Kantha":"IN.GU.BA",
	"Bharuch":"IN.GU.BH",
	"Bhavnagar":"IN.GU.BH",
	"Dohad":"IN.GU.DO",
	"Gandhinagar":"IN.GU.GA",
	"Jamnagar":"IN.GU.JA",
	"Junagadh":"IN.GU.JU",
	"Kachchh":"IN.GU.KA",
	"Kheda":"IN.GU.KH",
	"Mahesana":"IN.GU.MA",
	"Narmada":"IN.GU.NA",
	"Navsari":"IN.GU.NA",
	"Panch Mahals":"IN.GU.PA",
	"Patan":"IN.GU.PA",
	"Porbandar":"IN.GU.PO",
	"Rajkot":"IN.GU.RA",
	"Sabar Kantha":"IN.GU.SA",
	"Surat":"IN.GU.SU",
	"Surendranagar":"IN.GU.SU",
	"The Dangs":"IN.GU.TH",
	"Vadodara":"IN.GU.VA",
	"Valsad":"IN.GU.VA",
	"Ambala":"IN.HA.AM",
	"Bhiwani":"IN.HA.BH",
	"Faridabad":"IN.HA.FA",
	"Fatehabad":"IN.HA.FA",
	"Gurgaon":"IN.HA.GU",
	"Hisar":"IN.HA.HI",
	"Jhajjar":"IN.HA.JH",
	"Jind":"IN.HA.JI",
	"Kaithal":"IN.HA.KA",
	"Karnal":"IN.HA.KA",
	"Kurukshetra":"IN.HA.KU",
	"Mahendragarh":"IN.HA.MA",
	"Panchkula":"IN.HA.PA",
	"Panipat":"IN.HA.PA",
	"Rewari":"IN.HA.RE",
	"Rohtak":"IN.HA.RO",
	"Sirsa":"IN.HA.SI",
	"Sonipat":"IN.HA.SO",
	"Yamunanagar":"IN.HA.YA",
	"Bilaspur":"IN.HI.BI",
	"Chamba":"IN.HI.CH",
	"Hamirpur":"IN.HI.HA",
	"Kangra":"IN.HI.KA",
	"Kinnaur":"IN.HI.KI",
	"Kullu":"IN.HI.KU",
	"Lahul & Spiti":"IN.HI.LA",
	"Mandi":"IN.HI.MA",
	"Shimla":"IN.HI.SH",
	"Sirmaur":"IN.HI.SI",
	"Solan":"IN.HI.SO",
	"Una":"IN.HI.UN",
	"Anantnag":"IN.JA.AN",
	"Badgam":"IN.JA.BA",
	"Baramula":"IN.JA.BA",
	"Doda":"IN.JA.DO",
	"Jammu":"IN.JA.JA",
	"Kargil":"IN.JA.KA",
	"Kathua":"IN.JA.KA",
	"Kupwara":"IN.JA.KU",
	"Leh (Ladakh)":"IN.JA.LE",
	"Pulwama":"IN.JA.PU",
	"Punch":"IN.JA.PU",
	"Rajouri":"IN.JA.RA",
	"Srinagar":"IN.JA.SR",
	"Udhampur":"IN.JA.UD",
	"Bokaro":"IN.JH.BO",
	"Chatra":"IN.JH.CH",
	"Deoghar":"IN.JH.DE",
	"Dhanbad":"IN.JH.DH",
	"Dumka":"IN.JH.DU",
	"Garhwa":"IN.JH.GA",
	"Giridih":"IN.JH.GI",
	"Godda":"IN.JH.GO",
	"Gumla":"IN.JH.GU",
	"Hazaribagh":"IN.JH.HA",
	"Jamtara":"IN.JH.JA",
	"Kodarma":"IN.JH.KO",
	"Latehar":"IN.JH.LA",
	"Lohardaga":"IN.JH.LO",
	"Pakur":"IN.JH.PA",
	"Palamu":"IN.JH.PA",
	"Pashchimi Singhbhum":"IN.JH.PA",
	"Purbi Singhbhum":"IN.JH.PU",
	"Ranchi":"IN.JH.RA",
	"Sahibganj":"IN.JH.SA",
	"SaraikelaKharsawan":"IN.JH.SA",
	"Simdega":"IN.JH.SI",
	"Bagalkot":"IN.KA.BA",
	"Bangalore Rural":"IN.KA.BA",
	"Bangalore":"IN.KA.BA",
	"Belgaum":"IN.KA.BE",
	"Bellary":"IN.KA.BE",
	"Bidar":"IN.KA.BI",
	"Bijapur":"IN.KA.BI",
	"Chamarajanagar":"IN.KA.CH",
	"Chikmagalur":"IN.KA.CH",
	"Chitradurga":"IN.KA.CH",
	"Dakshina Kannada":"IN.KA.DA",
	"Davanagere":"IN.KA.DA",
	"Dharwad":"IN.KA.DH",
	"Gadag":"IN.KA.GA",
	"Gulbarga":"IN.KA.GU",
	"Hassan":"IN.KA.HA",
	"Haveri":"IN.KA.HA",
	"Kodagu":"IN.KA.KO",
	"Kolar":"IN.KA.KO",
	"Koppal":"IN.KA.KO",
	"Mandya":"IN.KA.MA",
	"Mysore":"IN.KA.MY",
	"Raichur":"IN.KA.RA",
	"Shimoga":"IN.KA.SH",
	"Tumkur":"IN.KA.TU",
	"Udupi":"IN.KA.UD",
	"Uttara Kannada":"IN.KA.UT",
	"Alappuzha":"IN.KL.AL",
	"Ernakulam":"IN.KL.ER",
	"Idukki":"IN.KL.ID",
	"Kannur":"IN.KL.KA",
	"Kasaragod":"IN.KL.KA",
	"Kollam":"IN.KL.KO",
	"Kottayam":"IN.KL.KO",
	"Kozhikode":"IN.KL.KO",
	"Malappuram":"IN.KL.MA",
	"Palakkad":"IN.KL.PA",
	"Pathanamthitta":"IN.KL.PA",
	"Thiruvananthapuram":"IN.KL.TH",
	"Thrissur":"IN.KL.TH",
	"Wayanad":"IN.KL.WA",
	"Lakshadweep":"IN.LA.LA",
	"Anuppur":"IN.MP.AN",
	"Ashoknagar":"IN.MP.AS",
	"Balaghat":"IN.MP.BA",
	"Barwani":"IN.MP.BA",
	"Betul":"IN.MP.BE",
	"Bhind":"IN.MP.BH",
	"Bhopal":"IN.MP.BH",
	"Burhanpur":"IN.MP.BU",
	"Chhatarpur":"IN.MP.CH",
	"Chhindwara":"IN.MP.CH",
	"Damoh":"IN.MP.DA",
	"Datia":"IN.MP.DA",
	"Dewas":"IN.MP.DE",
	"Dhar":"IN.MP.DH",
	"Dindori":"IN.MP.DI",
	"Khandwa (East Nimar)":"IN.MP.KH",
	"Guna":"IN.MP.GU",
	"Gwalior":"IN.MP.GW",
	"Harda":"IN.MP.HA",
	"Hoshangabad":"IN.MP.HO",
	"Indore":"IN.MP.IN",
	"Jabalpur":"IN.MP.JA",
	"Jhabua":"IN.MP.JH",
	"Katni":"IN.MP.KA",
	"Mandla":"IN.MP.MA",
	"Mandsaur":"IN.MP.MP",
	"Morena":"IN.MP.MO",
	"Narsimhapur":"IN.MP.NA",
	"Neemuch":"IN.MP.NE",
	"Panna":"IN.MP.PA",
	"Raisen":"IN.MP.RA",
	"Rajgarh":"IN.MP.RA",
	"Ratlam":"IN.MP.RA",
	"Rewa":"IN.MP.RE",
	"Sagar":"IN.MP.SA",
	"Satna":"IN.MP.SA",
	"Sehore":"IN.MP.SE",
	"Seoni":"IN.MP.SE",
	"Shahdol":"IN.MP.SH",
	"Shajapur":"IN.MP.SH",
	"Sheopur":"IN.MP.SH",
	"Shivpuri":"IN.MP.SH",
	"Sidhi":"IN.MP.SI",
	"Tikamgarh":"IN.MP.TI",
	"Ujjain":"IN.MP.UJ",
	"Umaria":"IN.MP.UM",
	"Vidisha":"IN.MP.VI",
	"Khargone (West Nimar)":"IN.MP.KH",
	"Ahmadnagar":"IN.MA.AH",
	"Akola":"IN.MA.AK",
	"Amravati":"IN.MA.AM",
	"Aurangabad":"IN.MA.AU",
	"Bhandara":"IN.MA.BH",
	"Bid":"IN.MA.BI",
	"Buldana":"IN.MA.BU",
	"Chandrapur":"IN.MA.CH",
	"Dhule":"IN.MA.DH",
	"Gadchiroli":"IN.MA.GA",
	"Gondiya":"IN.MA.GO",
	"Greater Bombay":"IN.MA.GR",
	"Hingoli":"IN.MA.HI",
	"Jalgaon":"IN.MA.JA",
	"Jalna":"IN.MA.JA",
	"Kolhapur":"IN.MA.KO",
	"Latur":"IN.MA.LA",
	"Nagpur":"IN.MA.NA",
	"Nanded":"IN.MA.NA",
	"Nandurbar":"IN.MA.NA",
	"Nashik":"IN.MA.NA",
	"Osmanabad":"IN.MA.OS",
	"Parbhani":"IN.MA.PA",
	"Pune":"IN.MA.PU",
	"Raigarh":"IN.MA.RA",
	"Ratnagiri":"IN.MA.RA",
	"Sangli":"IN.MA.SA",
	"Satara":"IN.MA.SA",
	"Sindhudurg":"IN.MA.SI",
	"Solapur":"IN.MA.SO",
	"Thane":"IN.MA.TH",
	"Wardha":"IN.MA.WA",
	"Washim":"IN.MA.WA",
	"Yavatmal":"IN.MA.YA",
	"Bishnupur":"IN.MA.BI",
	"Chandel":"IN.MA.CH",
	"Churachandpur":"IN.MA.CH",
	"Imphal East":"IN.MA.IM",
	"Senapati":"IN.MA.SE",
	"Tamenglong":"IN.MA.TA",
	"Thoubal":"IN.MA.TH",
	"Ukhrul":"IN.MA.UK",
	"Imphal West":"IN.MA.IM",
	"East Garo Hills":"IN.ME.EA",
	"East Khasi Hills":"IN.ME.EA",
	"Jaintia Hills":"IN.ME.JA",
	"Ribhoi":"IN.ME.RI",
	"South Garo Hills":"IN.ME.SO",
	"West Garo Hills":"IN.ME.WE",
	"West Khasi Hills":"IN.ME.WE",
	"Aizawl":"IN.MI.AI",
	"Champhai":"IN.MI.CH",
	"Kolasib":"IN.MI.KO",
	"Lawngtlai":"IN.MI.LA",
	"Lunglei":"IN.MI.LU",
	"Mamit":"IN.MI.MA",
	"Saiha":"IN.MI.SA",
	"Serchhip":"IN.MI.SE",
	"Dimapur":"IN.NA.DI",
	"Kohima":"IN.NA.KO",
	"Mokokchung":"IN.NA.MO",
	"Mon":"IN.NA.MO",
	"Phek":"IN.NA.PH",
	"Tuensang":"IN.NA.TU",
	"Wokha":"IN.NA.WO",
	"Zunheboto":"IN.NA.ZU",
	"Anugul":"IN.OD.AN",
	"Baleshwar":"IN.OD.BA",
	"Bargarh":"IN.OD.BA",
	"Bhadrak":"IN.OD.BH",
	"Balangir":"IN.OD.BA",
	"Baudh":"IN.OD.BA",
	"Cuttack":"IN.OD.CU",
	"Debagarh":"IN.OD.DE",
	"Dhenkanal":"IN.OD.DH",
	"Gajapati":"IN.OD.GA",
	"Ganjam":"IN.OD.GA",
	"Jagatsinghapur":"IN.OD.JA",
	"Jajapur":"IN.OD.JA",
	"Jharsuguda":"IN.OD.JH",
	"Kalahandi":"IN.OD.KA",
	"Kandhamal":"IN.OD.KA",
	"Kendrapara":"IN.OD.KE",
	"Kendujhar":"IN.OD.KE",
	"Khordha":"IN.OD.KH",
	"Koraput":"IN.OD.KO",
	"Malkangiri":"IN.OD.MA",
	"Mayurbhanj":"IN.OD.MA",
	"Nabarangapur":"IN.OD.NA",
	"Nayagarh":"IN.OD.NA",
	"Nuapada":"IN.OD.NU",
	"Puri":"IN.OD.PU",
	"Rayagada":"IN.OD.RA",
	"Sambalpur":"IN.OD.SA",
	"Subarnapur (Sonapur)":"IN.OD.SU",
	"Sundargarh":"IN.OD.SU",
	"Karaikal":"IN.PU.KA",
	"Mahe":"IN.PU.MA",
	"Puducherry":"IN.PU.PU",
	"Yanam":"IN.PU.YA",
	"Amritsar":"IN.PU.AM",
	"Bathinda":"IN.PU.BA",
	"Faridkot":"IN.PU.FA",
	"Fatehgarh Sahib":"IN.PU.FA",
	"Firozpur":"IN.PU.FI",
	"Gurdaspur":"IN.PU.GU",
	"Hoshiarpur":"IN.PU.HO",
	"Jalandhar":"IN.PU.JA",
	"Kapurthala":"IN.PU.KA",
	"Ludhiana":"IN.PU.LU",
	"Mansa":"IN.PU.MA",
	"Moga":"IN.PU.MO",
	"Muktsar":"IN.PU.MU",
	"Shahid Bhagat Singh Nagar (Nawanshahr)":"IN.PU.SH",
	"Patiala":"IN.PU.PA",
	"Rupnagar":"IN.PU.RU",
	"Sangrur":"IN.PU.SA",
	"Ajmer":"IN.RA.AJ",
	"Alwar":"IN.RA.AL",
	"Banswara":"IN.RA.BA",
	"Baran":"IN.RA.BA",
	"Barmer":"IN.RA.BA",
	"Bharatpur":"IN.RA.BH",
	"Bhilwara":"IN.RA.BH",
	"Bikaner":"IN.RA.BI",
	"Bundi":"IN.RA.BU",
	"Chittaurgarh":"IN.RA.CH",
	"Churu":"IN.RA.CH",
	"Dausa":"IN.RA.DA",
	"Dhaulpur":"IN.RA.DH",
	"Dungarpur":"IN.RA.DU",
	"Ganganagar":"IN.RA.GA",
	"Hanumangarh":"IN.RA.HA",
	"Jaipur":"IN.RA.JA",
	"Jaisalmer":"IN.RA.JA",
	"Jalor":"IN.RA.JA",
	"Jhalawar":"IN.RA.JH",
	"Jhunjhunun":"IN.RA.JH",
	"Jodhpur":"IN.RA.JO",
	"Karauli":"IN.RA.KA",
	"Kota":"IN.RA.KO",
	"Nagaur":"IN.RA.NA",
	"Pali":"IN.RA.PA",
	"Rajsamand":"IN.RA.RA",
	"Sawai Madhopur":"IN.RA.SA",
	"Sikar":"IN.RA.SI",
	"Sirohi":"IN.RA.SI",
	"Tonk":"IN.RA.TO",
	"Udaipur":"IN.RA.UD",
	"East District":"IN.SI.EA",
	"North  District":"IN.SI.NO",
	"South District":"IN.SI.SO",
	"West District":"IN.SI.WE",
	"Ariyalur  ":"IN.TA.AR",
	"Chennai":"IN.TA.CH",
	"Coimbatore":"IN.TA.CO",
	"Cuddalore":"IN.TA.CU",
	"Dharmapuri":"IN.TA.DH",
	"Dindigul":"IN.TA.DI",
	"Erode":"IN.TA.ER",
	"Kancheepuram":"IN.TA.KA",
	"Kanniyakumari":"IN.TA.KA",
	"Karur ":"IN.TA.KA",
	"Madurai":"IN.TA.MA",
	"Nagapattinam  ":"IN.TA.NA",
	"Namakkal   ":"IN.TA.NA",
	"The Nilgiris":"IN.TA.TH",
	"Perambalur  ":"IN.TA.PE",
	"Pudukkottai":"IN.TA.PU",
	"Ramanathapuram":"IN.TA.RA",
	"Salem":"IN.TA.SA",
	"Sivaganga":"IN.TA.SI",
	"Thanjavur":"IN.TA.TH",
	"Theni  ":"IN.TA.TH",
	"Thiruvallur":"IN.TA.TH",
	"Thiruvarur":"IN.TA.TH",
	"Thoothukkudi":"IN.TA.TH",
	"Tiruchirappalli":"IN.TA.TI",
	"Tirunelveli ":"IN.TA.TI",
	"Tiruvannamalai":"IN.TA.TI",
	"Vellore":"IN.TA.VE",
	"Viluppuram":"IN.TA.VI",
	"Virudhunagar":"IN.TA.VI",
	"Dhalai":"IN.TR.DH",
	"North Tripura":"IN.TR.NO",
	"South Tripura ":"IN.TR.SO",
	"West Tripura ":"IN.TR.WE",
	"Agra":"IN.UT.AG",
	"Aligarh":"IN.UT.AL",
	"Allahabad":"IN.UT.AL",
	"Ambedkar Nagar":"IN.UT.AM",
	"Auraiya":"IN.UT.AU",
	"Azamgarh":"IN.UT.AZ",
	"Budaun":"IN.UT.BU",
	"Baghpat":"IN.UT.BA",
	"Bahraich":"IN.UT.BA",
	"Ballia":"IN.UT.BA",
	"Balrampur":"IN.UT.BA",
	"Banda":"IN.UT.BA",
	"Barabanki":"IN.UT.BA",
	"Bareilly":"IN.UT.BA",
	"Basti":"IN.UT.BA",
	"Bijnor":"IN.UT.BI",
	"Bulandshahr ":"IN.UT.BU",
	"Chandauli":"IN.UT.CH",
	"Chitrakoot":"IN.UT.CH",
	"Deoria":"IN.UT.DE",
	"Etah":"IN.UT.ET",
	"Etawah":"IN.UT.ET",
	"Faizabad":"IN.UT.FA",
	"Farrukhabad":"IN.UT.FA",
	"Fatehpur":"IN.UT.FA",
	"Firozabad":"IN.UT.FI",
	"Gautam Buddha Nagar":"IN.UT.GA",
	"Ghaziabad":"IN.UT.GH",
	"Ghazipur":"IN.UT.GH",
	"Gonda":"IN.UT.GO",
	"Gorakhpur":"IN.UT.GO",
	"Hamirpur":"IN.UT.HA",
	"Hardoi":"IN.UT.HA",
	"Mahamaya Nagar (Hathras)":"IN.UT.MA",
	"Jalaun":"IN.UT.JA",
	"Jaunpur":"IN.UT.JA",
	"Jhansi":"IN.UT.JH",
	"Jyotiba Phule Nagar":"IN.UT.JY",
	"Kannauj":"IN.UT.KA",
	"Kanpur Nagar":"IN.UT.KA",
	"Kanpur Dehat":"IN.UT.KA",
	"Kaushambi":"IN.UT.KA",
	"Kushinagar":"IN.UT.KU",
	"Kheri":"IN.UT.KH",
	"Lalitpur":"IN.UT.LA",
	"Lucknow":"IN.UT.LU",
	"Maharajganj":"IN.UT.MA",
	"Mahoba":"IN.UT.MA",
	"Mainpuri":"IN.UT.MA",
	"Mathura":"IN.UT.MA",
	"Mau":"IN.UT.MA",
	"Meerut":"IN.UT.ME",
	"Mirzapur":"IN.UT.MI",
	"Moradabad":"IN.UT.MO",
	"Muzaffarnagar":"IN.UT.MU",
	"Pilibhit":"IN.UT.PI",
	"Pratapgarh":"IN.UT.PR",
	"Rae Bareli":"IN.UT.RA",
	"Rampur":"IN.UT.RA",
	"Saharanpur":"IN.UT.SA",
	"Sant Kabir Nagar":"IN.UT.SA",
	"Sant Ravidas Nagar (Bhadohi)":"IN.UT.SA",
	"Shahjahanpur":"IN.UT.SH",
	"Shravasti":"IN.UT.SH",
	"Siddharthnagar":"IN.UT.SI",
	"Sitapur":"IN.UT.SI",
	"Sonbhadra":"IN.UT.SO",
	"Sultanpur":"IN.UT.SU",
	"Unnao":"IN.UT.UN",
	"Varanasi":"IN.UT.VA",
	"Almora":"IN.UT.AL",
	"Bageshwar":"IN.UT.BA",
	"Chamoli":"IN.UT.CH",
	"Champawat":"IN.UT.CH",
	"Dehradun":"IN.UT.DE",
	"Hardwar":"IN.UT.HA",
	"Nainital":"IN.UT.NA",
	"Garhwal":"IN.UT.GA",
	"Pithoragarh":"IN.UT.PI",
	"Rudraprayag":"IN.UT.RU",
	"Tehri Garhwal":"IN.UT.TE",
	"Udham Singh Nagar":"IN.UT.UD",
	"Uttarkashi":"IN.UT.UT",
	"Bankura":"IN.WE.BA",
	"Barddhaman":"IN.WE.BA",
	"Birbhum":"IN.WE.BI",
	"Dakshin Dinajpur":"IN.WE.DA",
	"Darjiling":"IN.WE.DA",
	"Purba Medinipur":"IN.WE.PU",
	"Haora":"IN.WE.HA",
	"Hugli":"IN.WE.HU",
	"Jalpaiguri":"IN.WE.JA",
	"Koch Bihar":"IN.WE.KO",
	"Kolkata":"IN.WE.KO",
	"Maldah":"IN.WE.MA",
	"Murshidabad":"IN.WE.MU",
	"Nadia":"IN.WE.NA",
	"North Twenty Four Pargan":"IN.WE.NO",
	"Puruliya":"IN.WE.PU",
	"South Twenty Four Parganas":"IN.WE.SO",
	"Uttar Dinajpur":"IN.WE.UT",
	"Paschim Medinipur":"IN.WE.PA",


}

CODE_NAME = dict([(v, k) for k, v in NAME_CODE.items()])


# we want to limit the decimal precision of the percentage figures
# from http://stackoverflow.com/a/1733105/3189
class PrettyFloat(float):
    def __repr__(self):
        return '%.3f' % self


def pretty_floats(obj):
    if isinstance(obj, float):
        return PrettyFloat(obj)
    elif isinstance(obj, dict):
        return dict((k, pretty_floats(v)) for k, v in obj.items())
    elif isinstance(obj, (list, tuple)):
        return map(pretty_floats, obj)
    return obj


def add_data_for_cell(sheet, row, col, datadict, key):
    if sheet.cell_type(row, col) == xlrd.XL_CELL_NUMBER:
        datadict[key] = sheet.cell_value(row, col)


def process_percent_sheet(sheet, data):
    """ returns dictionary, key is country code, value is dictionary of
    year: value, or None if no data """
    col_key_mapping = [
        (6, 'indicator1_initial'),
        (7, 'indicator1_increase'),
        (8, 'indicator2_initial'),
        (9, 'indicator2_increase')
    ]

    for curr_row in xrange(1, sheet.nrows):
        country_name = sheet.cell_value(curr_row, 0)
        if country_name in NAME_CODE and NAME_CODE[country_name]:
            country_code = NAME_CODE[country_name]
        else:
            #print "%s not found" % country_name
            continue

        if country_code not in data:
            data[country_code] = {'name': CODE_NAME[country_code]}

        for col, key in col_key_mapping:
            add_data_for_cell(sheet, curr_row, col, data[country_code], key)

    return data


def process_absolute_sheet(sheet, data):
    """ returns dictionary, key is country code, value is dictionary of
    year: value, or None if no data """
    col_key_mapping = [
        (1, 'water_pop_current'),
        (2, 'water_pop_universal'),
        (3, 'sanitation_pop_current'),
        (4, 'sanitation_pop_universal')
    ]

    for curr_row in xrange(2, sheet.nrows):
        country_name = sheet.cell_value(curr_row, 0)
        if country_name in NAME_CODE and NAME_CODE[country_name]:
            country_code = NAME_CODE[country_name]
        else:
            #print "%s not found" % country_name
            continue

        if country_code not in data:
            data[country_code] = {'name': CODE_NAME[country_code]}

        for col, key in col_key_mapping:
            add_data_for_cell(sheet, curr_row, col, data[country_code], key)

    return data


def main(argv):
    opts = docopt(__doc__, argv[1:])

    # somaliland has the label "-99" in the map data, and no data in the
    # spreadsheets, but we still want a label.
    data = {"-99": {"name": "Somaliland"}}

    #xls2json.py [--verbose] <xlsPercentFile> <xlsAbsoluteFile>
    percent_book = xlrd.open_workbook(opts['<xlsPercentFile>'])
    percent_sheet = percent_book.sheet_by_index(0)
    data = process_percent_sheet(percent_sheet, data)

    absolute_book = xlrd.open_workbook(opts['<xlsAbsoluteFile>'])
    absolute_sheet = absolute_book.sheet_by_index(0)
    data = process_absolute_sheet(absolute_sheet, data)

    # limit float precision when printed
    data = pretty_floats(data)
    if opts['--verbose']:
        # pretty print the javascript
        print json.dumps(data, indent=4, sort_keys=True)
    else:
        # compressed javascript
        print json.dumps(data, separators=(',', ':'))
    with open("output.txt", 'w') as outfile:
		json.dump(data, outfile)
		
	#return 0

if __name__ == '__main__':
    sys.exit(main(sys.argv))
